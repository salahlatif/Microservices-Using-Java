* Create Spring boot project with following dependencies
* USE **1.4.1.RELEASE** version

		<dependency>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-web</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-oauth2</artifactId>
		</dependency>
		<dependency>
			<groupId>org.springframework.cloud</groupId>
			<artifactId>spring-cloud-starter-security</artifactId>
		</dependency>

* Annotate main class with @EnableAuthorizationServer


		@SpringBootApplication
		@EnableAuthorizationServer
		public class Application {
		public static void main(String[] args) {
			SpringApplication.run(Application.class, args);
		}
		}


 * Add following code to application.peroperties


		server.port: 9000
		spring.security.user.name: sagar
		spring.security.user.password: password
		spring.security.user.roles=: USER
		security.oauth2.client.clientId: rosemont
		security.oauth2.client.clientSecret: rosemont
		security.oauth2.client.authorized-grant-types: authorization_code,refresh_token,password,client_credentials
		security.oauth2.client.scope:person_read,person_report

* Start the server
* open postman and configure a **post**  request to **localhost:9000/oauth/token**  
* In Authorization tab select **Basic Auth** with Username as **rosemont** and password as **rosemont**
 
* Add following key-value pairs in **x-www-form-urlencoded** section of **Body**

	grant_type = password
	client_id = rosemont
	username = sagar
	password = password

* Send the request; you should receive access token


------------------------------------------------------------

* comment out following lines from application.properties

		#spring.security.user.name: sagar
		#spring.security.user.password: password
		#spring.security.user.roles=: USER

* Create ServiceConfig class and following code

		@Configuration
		public class ServiceConfig extends GlobalAuthenticationConfigurerAdapter {
		@Override
		public void init(AuthenticationManagerBuilder auth) throws Exception {
			auth.inMemoryAuthentication().withUser("mosalah").password("pass1").roles("USER").and()
			.withUser("husalaha").password("pass2").roles("USER","OPERATOR");
		}
		}

* Open postman and send request to Authorization server with new user credentials

	grant_type = password
	client_id = rosemont
	username = mosalah
	password = pass1
	
* Copy the access_token and and paste it in notepad

		{
	    "access_token": "b772c44d-a25f-417d-8029-2a5e03461cd7",
	    "token_type": "bearer",
	    "refresh_token": "a6b87226-5568-4ec0-9e8c-f40087ccc9e1",
	    "expires_in": 43186,
	    "scope": "person_read person_report"
		}


------------------------------------------------------------

* *Following steps are for using the new authorization server*
	
* Add @EnableResourceServer & @RestController annotations to main class
* Add a request method


		@SpringBootApplication
		@EnableAuthorizationServer
		@EnableResourceServer
		@RestController
		public class Application { 
		public static void main(String[] args) {
			SpringApplication.run(Application.class, args);
		}
		@RequestMapping("/user")
		public Principal user(Principal user){
			return user;
		}
		}

* Open application.properties file of 09.Microservices-Creating-A-Resource-Server-And-Routing-Tokens-To-Services

* Update it to use the new created authorization server instead of git hub


		server.port=9090
		#security.oauth2.resource.user-info-uri=https://api.github.com/user
		security.oauth2.resource.user-info-uri=http://localhost:9000/user

* Start the 09.Microservices-Creating-A-Resource-Server-And-Routing-Tokens-To-Services service

* Go to Postman
* Access *http://localhost:9090/data* service 
* Select No Auth in authorization type
* Add following header
	
	Authorization = Bearer b772c44d-a25f-417d-8029-2a5e03461cd7

* b772c44d-a25f-417d-8029-2a5e03461cd7 is the token generated by the authorization server
